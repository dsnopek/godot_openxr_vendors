name: XR Simulator Tests

# TEst

on: [push, pull_request]

jobs:
  test:
   runs-on: windows-2019

   steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Download pyvrs
        run: |
          git clone https://github.com/facebookresearch/pyvrs.git
          cd pyvrs
          git submodule sync --recursive
          git submodule update --init --recursive

      - name: Download Godot
        run: |
          $fileId = "1CvY7nqkqMbASpUrywtMvVfjXj9zyEj4H"
          $fileName = "godot.zip"
          $cookiePath = "$env:TEMP\cookies.txt"

          # Step 1: Get the confirmation token
          $initialUrl = "https://docs.google.com/uc?export=download&id=$fileId"
          $response = Invoke-WebRequest -Uri $initialUrl -SessionVariable session -UseBasicParsing
          $confirmToken = ($response.Content -split "`n" | Where-Object { $_ -match 'confirm=' }).Split("=")[1].Split("&")[0]

          # Step 2: Use the token to download the file
          $downloadUrl = "https://docs.google.com/uc?export=download&confirm=$confirmToken&id=$fileId"
          Invoke-WebRequest -Uri $downloadUrl -WebSession $session -OutFile $fileName -UseBasicParsing

          # Clean up
          Remove-Item $cookiePath -ErrorAction Ignore
        shell: pwsh

      - name: Extract Godot
        run: |
          Expand-Archive -Path "godot.zip" -DestinationPath .
          dir

      - name: Download Meta XR Simulator
        run: |
          Invoke-WebRequest -Uri "https://securecdn.oculus.com/binaries/download/?id=7377333452380808&access_token=OCASsWfPgbJaWh6YZAJNHSebmBalnkZCtjwQJdZAu7vjdwoHZCAY8MDuTuLDpRZAV1O92ovkZAKYeHc8DK0goz41N1SOlzPkYpv5F6pLjv9fzQZDZD" -OutFile "download.zip"
        shell: pwsh

      - name: Extract Meta XR Simulator
        run: |
          Expand-Archive -Path "download.zip" -DestinationPath "C:\Meta\"

#      - name: Pixi
#          cd pyvrs
#          iwr -useb https://pixi.sh/install.ps1 | iex
#          pixi run install_pyvrs
#
#